* DSP MERES - VASS GABOR ES TOTH BALINT - III.EVF. INFO, 1995
* INTERPOL.ASM
* LINEARIS INTERPOLACIO

PRD	EQU 3		* BELSO ORA CIKLUSA
IMR	EQU 4		* IT MASZK
GREQ	EQU 5		* LOKALIS ES GLOBALIS MEMORIA HATARA

YN	EQU 0		* 6-OS LAP SEGEDVALTOZOI
XN	EQU 1
XNM1    EQU 2
DELTA   EQU 3
MODE    EQU 4

	AORG 0
	B SETUP		* RESET HATASARA

	AORG >18
	B TINT		* BELSO TIMER IT RUTIN CIME

	AORG >20
SETUP	EQU $
	DINT		* IT TILTAS
	LDPK 0		* 0-AS ADATLAP
	LALK >80
	SACL GREQ	* >80 LOKALIS, FELETTE GLOBALIS MEM.
	LACK >08
	SACL IMR	* BELSO ORA IT ENGEDELYEZES
	LALK +249
	SACL PRD	* BELSO ORA INIT (40KHZ ES KIMENET)
	LDPK 6		* 6-OS ADATLAP
        LACK 1
        SACL MODE
	EINT		* IT ENGEDELYEZES

WAIT	IDLE		* VEGTELEN CIKLUS
	B WAIT

TINT	EQU $		* IT RUTIN: A FELDOLGOZAS
        LAC MODE
	SUBK 1
	SACL MODE
        BNZ INTERP

	LACK 4
	SACL MODE
	LAC XN
	SACL XNM1
	IN XN,PA2	* A/D OLVASASA
	LAC XNM1
	SACL YN
        LAC XN
        SUB XNM1
        SACL DELTA      * DELTA = (XN - XNM1) / 4
        B WROUT

INTERP  LAC YN
        ADD DELTA
        SACL YN         * YN = YN + DELTA
WROUT	OUT YN,PA2	* KIMENET IRASA
	OUT YN,PA7	* TRIGGER
	RET

	END
